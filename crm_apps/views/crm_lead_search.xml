<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- Inherit and customize CRM Opportunity search view -->
    <record id="crm_lead_search_visa_custom" model="ir.ui.view">
        <field name="name">crm.lead.search.visa.custom</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
        <field name="arch" type="xml">
            
            <!-- Add custom search fields at the beginning -->
            <field name="name" position="before">
                <field name="service_number"
                       string="CRM Number"
                       filter_domain="[('service_number', 'ilike', self)]"/>
            </field>
            
            <!-- Add phone search after name -->
            <field name="name" position="after">
                <field name="phone_mobile_search"
                       string="Telefon"/>
                <field name="commercial_partner_id"
                       string="Firma nomi"
                       filter_domain="[('commercial_partner_id', 'ilike', self)]"/>
                <field name="visa_country_id"
                       string="Viza davlati"/>
            </field>
            
            <!-- Add Qarzdorlar and Haqdorlar filters after "Lost" filter -->
            <filter name="filter_lost" position="after">
                <separator/>
                <filter string="Qarzdorlar" 
                        name="filter_qarzdorlar" 
                        domain="[('finance_balance', '=', 0)]"
                        help="Customers who haven't paid yet"/>
                <filter string="Haqdorlar" 
                        name="filter_haqdorlar" 
                        domain="[('finance_balance', '&gt;', 0)]"
                        help="Customers who have made payments"/>
            </filter>
            
            <!-- Add custom group by options -->
            <filter name="country" position="after">
                <filter string="Viza davlati"
                        name="visa_country"
                        context="{'group_by':'visa_country_id'}"/>
            </filter>

        </field>
    </record>

</odoo>